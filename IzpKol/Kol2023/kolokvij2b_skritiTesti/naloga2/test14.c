#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {4014, 8023, 788, 1957, 938, 6301, 4975, 9581, 2990, 2062, 3196, 2352, 8919, 1219, 5283, 9307, 4405, 4652, 812, 3229, 7048, 2027, 3143, 6553, 3996, 6880, 5641, 573, 6569, 2161, 4200, 306, 74, 4219, 1457, 4730, 4804, 8947, 1764, 6602, 3862, 5921, 7876, 673, 883, 9349, 9871, 1692, 651, 1642, 8507, 7410, 300, 7142, 5412, 5481, 224, 3368, 3050, 656, 2315, 9606, 1152, 5077, 9525, 7050, 6132, 9614, 8842, 6079, 1472, 8349, 7710, 1807, 7775, 4886, 510, 9380, 6479, 70, 5483, 6339, 7917, 9682, 5099, 4559, 7414, 5740, 8916, 6754, 3935, 676, 3013, 8035, 6409, 3545, 6938, 8691, 7894, 1386, 8634, 156, 3305, 240, 1412, 2195, 8123, 5513, 111, 3948, 9892, 3612, 6769, 9506, 4615, 1016, 4567, 9161, 6770, 1672, 7589, 668, 4725, 478, 5879, 2657, 2553, 56, 805, 1390, 7433, 401, 3897, 6055, 6855, 3731, 2717, 806, 6865, 8945, 3470, 6351, 9970, 2552, 8875, 2549, 6726, 6268, 9280, 1102, 8575, 2973, 763, 1707, 8396, 1302, 8566, 2877, 7505, 9004, 9502, 3162, 522, 1475, 6041, 1405, 3330, 7949, 2063, 3208, 8547, 8769, 823, 2362, 3169, 186, 987, 7723, 6974, 6037, 2432, 4054, 7787, 8817, 7842, 6591, 5503, 1174, 434, 4056, 3785, 678, 8892, 1406, 3668, 2310, 9024, 983, 1970, 7749, 8372, 8823, 3497, 9740, 3032, 7511, 1782, 1843, 6771, 5022, 6225, 7303, 7984, 1067, 2157, 6093, 5445, 4944, 2745, 7466, 6757, 3218, 7138, 685, 2708, 9112, 1220, 1682, 9216, 8303, 230, 8536, 2785, 7393, 1665, 1529, 4197, 5887, 7550, 5154, 4257, 716, 3618, 7401, 8883, 5539, 9586, 8728, 9629, 9481, 5005, 7197, 4375, 2090, 7897, 9917, 857, 5270, 1514, 6383, 7846, 2530, 3472, 3014, 3734, 5124, 1368, 6866, 9361, 4616, 6490, 1123, 650, 2541, 6955, 7542, 315, 8013, 209, 4042, 4622, 4593, 3688, 4747, 956, 2804, 9130, 4834, 7369, 2403, 3761, 2764, 9863, 3911, 1647, 8909, 7634, 9986, 8321, 2846, 8423, 4180, 2596, 1991, 5975, 2663, 9359, 991, 3094, 2595, 5377, 919, 1832, 9109, 1030, 8110, 3902, 3997, 7725, 8815, 5587, 8171, 1545, 5112, 455, 5552, 7728, 7499, 3286, 4857, 9545, 5718, 8336, 6574, 534, 9523, 4281, 5024, 790, 3943, 2227, 7888, 7861, 2146, 9661, 8268, 4473, 8901, 7300, 4665, 9851, 7272, 7932, 2279, 7189, 7094, 8905, 4094, 9256, 4799, 2264, 206, 1858, 2963, 6335, 6923, 7030, 2058, 4847, 657, 2356, 2073, 5538, 4449, 9045, 7513, 5891, 2980, 6805, 4263, 2078, 2770, 3399, 2943, 6291, 3448, 5521, 5557, 1044, 3447, 167, 5443, 7934, 1295, 7605, 4339, 7999, 3323, 7176, 3708, 75, 2992, 2639, 1110, 1111, 1190, 8708, 3753, 8983, 3244, 2125, 852, 1662, 4769, 310, 7796, 5941, 473, 5189, 4274, 491, 5908, 6509, 7509, 1410, 7388, 9702, 9319, 7819, 7781, 1578, 8544, 1534, 8653, 4382, 989, 7691, 9941, 2679, 7309, 4045, 3463, 9353, 1137, 8632, 9452, 9276, 9899, 488, 8042, 2018, 1920, 1095, 8376, 5601, 5997, 5876, 5102, 5526, 5201, 8994, 7122, 1101, 8545, 4481, 9759, 1935, 2816, 1821, 5532, 2311, 8186, 8045, 9500};
int _RAZREDI[] = {0, 1, 2, 0, 3, 2, 2, 4, 2, 2, 2, 5, 3, 3, 6, 7, 8, 9, 10, 11, 0, 12, 3, 2, 3, 7, 13, 14, 0, 0, 4, 2, 2, 2, 10, 15, 7, 16, 16, 6, 17, 0, 12, 18, 16, 9, 14, 9, 19, 20, 2, 14, 10, 0, 21, 3, 22, 2, 2, 23, 24, 2, 25, 2, 2, 9, 16, 26, 13, 27, 10, 10, 14, 28, 0, 0, 9, 29, 30, 2, 31, 32, 10, 4, 2, 33, 2, 8, 34, 14, 16, 26, 7, 0, 2, 16, 35, 9, 36, 33, 37, 14, 34, 19, 38, 39, 40, 1, 41, 7, 14, 35, 34, 42, 2, 36, 10, 10, 43, 0, 16, 34, 34, 44, 11, 45, 46, 9, 34, 47, 2, 48, 49, 16, 50, 51, 10, 0, 52, 2, 53, 54, 55, 11, 56, 57, 10, 10, 58, 7, 3, 59, 60, 2, 61, 62, 63, 64, 3, 65, 9, 0, 66, 9, 67, 7, 46, 4, 68, 19, 51, 16, 69, 6, 70, 64, 71, 72, 29, 72, 29, 73, 42, 16, 74, 75, 76, 2, 77, 2, 78, 79, 0, 80, 11, 10, 81, 82, 23, 37, 0, 83, 84, 14, 85, 86, 28, 87, 4, 88, 89, 90, 14, 10, 91, 85, 92, 85, 93, 16, 7, 10, 16, 94, 2, 29, 95, 96, 39, 97, 44, 10, 19, 59, 57, 98, 19, 99, 26, 12, 21, 100, 2, 0, 101, 102, 68, 93, 34, 26, 103, 7, 10, 28, 2, 104, 105, 16, 58, 106, 69, 107, 108, 37, 109, 110, 111, 97, 112, 72, 2, 0, 36, 113, 2, 16, 72, 114, 2, 115, 116, 14, 69, 117, 32, 118, 119, 120, 66, 65, 2, 9, 121, 21, 72, 0, 122, 123, 11, 124, 125, 126, 70, 10, 21, 47, 57, 127, 0, 128, 42, 71, 129, 10, 130, 4, 13, 88, 131, 61, 132, 9, 133, 67, 16, 88, 134, 135, 136, 85, 137, 138, 139, 119, 109, 4, 140, 97, 141, 142, 63, 142, 3, 10, 2, 143, 62, 144, 3, 20, 145, 146, 13, 19, 147, 4, 148, 149, 9, 58, 26, 16, 150, 74, 2, 10, 94, 151, 145, 152, 153, 4, 68, 0, 154, 155, 3, 156, 157, 9, 158, 1, 102, 159, 36, 160, 161, 2, 106, 162, 0, 163, 16, 33, 7, 45, 10, 164, 3, 165, 129, 137, 97, 131, 166, 7, 36, 14, 125, 97, 167, 14, 116, 168, 14, 143, 2, 169, 170, 30, 171, 32, 60, 20, 172, 113, 173, 88, 174, 19, 175, 176, 177, 3, 16, 52, 30, 10, 32, 178, 179, 105, 14, 26, 69, 179, 111, 106, 2, 180, 181, 182, 0, 103, 7, 34, 3, 177, 183, 184, 185, 51, 4, 10, 131, 186, 187, 30, 14, 39, 14, 2, 188, 49};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
