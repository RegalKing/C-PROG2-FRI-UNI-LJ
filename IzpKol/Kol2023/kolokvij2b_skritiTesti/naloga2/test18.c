#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {6969, 5121, 8902, 9457, 2146, 7693, 4391, 1922, 8206, 4480, 6435, 5341, 4710, 5185, 2755, 7033, 7388, 974, 669, 7831, 641, 8040, 7259, 4149, 4797, 2088, 8447, 5045, 2841, 6163, 5148, 8072, 3904, 9990, 5288, 944, 5245, 4207, 4512, 561, 3098, 4307, 8102, 6086, 1630, 7191, 9387, 2028, 5816, 2818, 8148, 2810, 9086, 354, 1985, 5278, 5187, 9708, 4647, 3414, 6710, 8574, 8815, 9020, 7515, 3189, 3484, 4317, 2332, 133, 2213, 8776, 3147, 4064, 3742, 3249, 4279, 1782, 8229, 5287, 104, 430, 1142, 5398, 4832, 1101, 8986, 2778, 9926, 2027, 4275, 1642, 8614, 1041, 5291, 6116, 5083, 6714, 528, 4884, 1075, 6599, 5176, 6568, 5350, 936, 808, 7527, 6040, 4680, 9947, 9802, 8595, 5317, 7860, 1920, 9441, 2260, 4532, 2439, 3701, 7406, 4693, 9000, 5054, 7306, 3103, 697, 868, 2627, 9451, 5301, 3958, 6381, 184, 5475, 5726, 60, 6268, 2973, 3606, 3409, 8824, 9014, 1439, 8186, 2807, 8541, 7295, 6977, 8245, 3638, 1995, 3711, 8981, 1843, 1565, 2287, 4407, 3605, 3764, 3201, 6333, 6113, 9975, 9012, 6242, 3295, 1113, 7923, 5439, 9379, 6893, 9726, 7384, 4604, 7351, 2833, 5981, 2626, 6283, 8065, 8421, 1016, 9619, 8777, 7519, 8354, 3888, 1332, 1666, 3136, 9231, 2937, 8451, 6475, 2663, 6915, 6730, 5882, 3746, 6777, 5615, 832, 9767, 5675, 9287, 9978, 5335, 6894, 9925, 5831, 4722, 667, 8133, 8991, 3887, 7416, 6504, 2514, 3320, 4652, 4446, 3618, 9523, 3094, 8417, 7446, 6591, 9581, 5803, 3774, 885, 8036, 2671, 8837, 216, 911, 5498, 7213, 506, 400, 6204, 1734, 7039, 526, 1997, 2173, 7718, 7821, 1460, 9723, 9575, 9487, 373, 9663, 4015, 8754, 7003, 9816, 7918, 2007, 2374, 8394, 8916, 365, 9506, 336, 7410, 4254, 5369, 2571, 5679, 722, 7761, 2902, 8695, 1395, 7247, 674, 8235, 6767, 449, 9343, 502, 491, 7082, 8740, 6495, 992, 9180, 5117, 1591, 4262, 8221, 881, 8505, 4979, 9178, 4914, 2644, 1092, 1722, 8716, 8571, 9876, 4928, 2282, 7429, 9452, 1879, 7324, 8667, 4404, 5621, 5234, 9034, 2195, 9174, 2427, 1711, 391, 4836, 3219, 1480, 4194, 3048, 4186, 2982, 6178, 3187, 3280, 7793, 3031, 8029, 35, 8764, 4686, 8539, 351, 5562, 7129, 2961, 2267, 4599, 8959, 8575, 7971, 8739, 5766, 6904, 7636, 3504, 2161, 9641, 9515, 5139, 8201, 2365, 7217, 4053, 6477, 2905, 8645, 5334, 4067, 8678, 3025, 9651, 7364, 3013, 1072, 6135, 1001, 6002, 8150, 3238, 5325, 5677, 5252, 1103, 125, 5205, 9629, 5556, 1928, 1329, 856, 9930, 1312, 6210, 7630, 8185, 3986, 9107, 6235, 2547, 5431, 6005, 3078, 8015, 9769, 1196, 8834, 7593, 8885, 1902, 4551, 9273, 7606, 2430, 3656, 9746, 7011, 1398, 4892, 2849, 6104, 6631, 2613, 6159, 2656, 4759, 9033, 5890, 5380, 4328, 9144, 4016, 65, 3041, 6054, 7881, 7407, 2986, 423, 3492, 6191, 8154, 5428, 4618, 8108, 661, 8907, 6455, 1157, 6569, 1584, 3099, 7615, 2829, 4389, 5905, 1085, 1253, 1243, 892, 7686, 6538, 8068, 4426, 2948, 199, 9588, 5547, 222, 407, 9571, 9983, 3024, 7174, 9468, 2031, 8965, 6885, 4208, 8330, 3810, 5814, 6515, 6315, 246};
int _RAZREDI[] = {0, 1, 0, 0, 2, 3, 3, 4, 5, 3, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 11, 0, 17, 2, 18, 11, 19, 20, 16, 21, 22, 23, 24, 1, 25, 26, 27, 11, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 25, 40, 41, 4, 42, 11, 43, 44, 45, 46, 4, 5, 47, 30, 48, 49, 50, 51, 52, 53, 54, 43, 6, 55, 56, 57, 58, 59, 60, 61, 37, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 25, 77, 78, 79, 31, 80, 81, 82, 83, 84, 85, 86, 87, 88, 66, 54, 89, 90, 91, 92, 93, 94, 95, 96, 97, 78, 98, 99, 9, 100, 101, 102, 103, 104, 105, 106, 55, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 25, 123, 124, 125, 126, 15, 61, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 25, 58, 102, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 124, 158, 168, 169, 170, 171, 62, 172, 78, 173, 157, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 50, 50, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 194, 199, 106, 200, 201, 127, 202, 203, 204, 192, 205, 206, 207, 208, 209, 210, 124, 98, 211, 212, 213, 214, 215, 216, 217, 218, 219, 98, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 76, 231, 232, 109, 233, 180, 234, 235, 236, 193, 134, 189, 237, 238, 239, 195, 240, 241, 242, 72, 243, 244, 245, 222, 246, 247, 76, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 84, 210, 258, 108, 259, 260, 261, 262, 263, 264, 265, 102, 79, 266, 267, 268, 269, 92, 270, 271, 272, 273, 179, 274, 275, 276, 66, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 134, 288, 234, 289, 290, 291, 292, 52, 5, 293, 294, 295, 296, 297, 298, 208, 178, 90, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 28, 310, 24, 311, 312, 138, 313, 314, 315, 161, 129, 316, 317, 318, 319, 320, 321, 322, 112, 323, 324, 325, 326, 327, 328, 5, 329, 330, 331, 332, 333, 334, 335, 109, 336, 337, 338, 339, 191, 340, 341, 342, 343, 344, 11, 345, 346, 33, 347, 348, 349, 350, 351, 352, 279, 353, 354, 355, 356, 52, 357, 358, 359, 166, 360, 361, 362, 363, 364, 365, 78, 351, 366, 367, 368, 369, 370, 371, 372, 373, 367, 374, 375, 376, 247, 16, 377, 4, 378, 379, 380, 107, 381, 382, 383, 384, 102, 385, 386, 387};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
