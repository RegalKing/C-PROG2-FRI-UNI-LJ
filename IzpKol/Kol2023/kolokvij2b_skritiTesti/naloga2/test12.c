#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {7557, 4978, 3560, 2280, 1329, 1912, 7063, 1586, 2695, 7183, 8841, 1615, 6918, 3887, 6848, 7622, 4329, 3546, 6966, 9796, 7597, 3863, 4818, 6649, 2764, 5816, 7114, 5673, 4084, 7502, 3743, 6423, 2864, 7920, 4306, 3879, 4909, 2415, 112, 3961, 5331, 1244, 4035, 4953, 2619, 7179, 2520, 5362, 5652, 8315, 7305, 6002, 9397, 4768, 7406, 3916, 2598, 2079, 2424, 3429, 1220, 2077, 2640, 9345, 6405, 8407, 9546, 7291, 7609, 5756, 4506, 3819, 7553, 9209, 9290, 5793, 7198, 7147, 8794, 9396, 7480, 9106, 5113, 6739, 6066, 5724, 1274, 8189, 3593, 6951, 711, 6176, 3191, 497, 9111, 4172, 6032, 2483, 4772, 60, 2802, 4490, 6256, 1786, 7941, 8906, 8585, 7748, 6166, 9226, 8740, 8195, 6840, 4168, 7543, 2184, 8655, 506, 1628, 5170, 8411, 6999, 7352, 7876, 7779, 5785, 1491, 9197, 4782, 8090, 4566, 9947, 6238, 1306, 3452, 2961, 9862, 5111, 7265, 6030, 603, 4180, 8226, 1903, 7989, 8888, 2756, 9283, 1312, 6534, 5186, 7654, 5866, 8531, 6314, 6945, 2919, 1562, 8120, 9264, 8601, 940, 8242, 8354, 635, 1634, 3407, 4417, 4816, 8703, 8236, 579, 9702, 9395, 7167, 3179, 9655, 1022, 3264, 6228, 3981, 9708, 9714, 1777, 9476, 2853, 7248, 6138, 8233, 9000, 8682, 3124, 1698, 5936, 264, 5996, 7413, 9372, 3263, 882, 9258, 2509, 1678, 667, 3579, 8149, 9380, 5942, 3005, 8643, 7840, 4686, 5709, 3750, 4920, 5725, 6152, 3156, 5031, 3584, 5819, 8188, 39, 3327, 9273, 8415, 8746, 9771, 1262, 2367, 9368, 3382, 2683, 6625, 559, 6051, 8584, 5455, 5201, 3931, 4263, 5791, 9848, 6346, 6231, 1343, 9678, 3786, 4274, 3514, 7909, 7715, 9489, 2684, 3059, 1149, 2589, 8874, 3151, 7061, 6015, 9243, 7999, 8534, 1134, 7685, 5363, 7237, 463, 7736, 2091, 8792, 3411, 1548, 7796, 884, 3783, 6193, 4895, 4843, 7262, 641, 9697, 5234, 6011, 7083, 3689, 328, 398, 958, 9756, 504, 3747, 6877, 8390, 7559, 97, 7014, 6942, 5094, 7317, 6366, 942, 7107, 4639, 4321, 361, 2590, 2989, 677, 6652, 6786, 6734, 1261, 7277, 5080, 593, 6097, 2204, 6653, 4017, 4690, 2898, 7389, 2964, 8331, 9118, 2168, 1151, 8869, 1524, 9340, 5916, 8557, 6698, 9301, 4518, 7647, 4401, 9518, 8893, 1803, 4487, 8010, 8352, 4829, 731, 4247, 6341, 7013, 3071, 2407, 1713, 63, 5247, 2538, 7740, 5472, 788, 7511, 5748, 1932, 4482, 7972, 3716, 6286, 7731};
int _RAZREDI[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 5, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 1, 0, 0, 1, 0, 0, 9, 0, 10, 11, 0, 0, 0, 0, 12, 0, 0, 0, 13, 0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 15, 0, 0, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 1, 0, 1, 18, 0, 0, 19, 20, 0, 0, 0, 3, 21, 0, 0, 0, 0, 13, 0, 1, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 22, 0, 0, 0, 5, 1, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 11, 0, 0, 0, 23, 24, 0, 0, 0, 0, 0, 0, 2, 0, 19, 0, 0, 1, 0, 21, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 25, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 26, 0, 27, 0, 0, 0, 0, 0};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
