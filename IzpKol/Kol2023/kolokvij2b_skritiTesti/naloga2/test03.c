#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {5111, 6117, 1623, 772, 3081, 1542, 6463, 4220, 7922, 9542, 8723, 7362, 4216, 8421, 2364, 8627, 7127, 6774, 8401, 5977, 6043, 9273, 5270, 4855, 4736, 159, 808, 1699, 2875, 3529, 5, 5166, 8360, 3758, 8134, 7510, 2165, 8130, 5817, 9618, 6146, 4264, 9234, 1980, 3079, 649, 5762, 3997, 2721, 3413, 6671, 9749, 6045, 1386, 66, 8378, 2691, 9806, 6639, 6137, 4951, 2604, 676, 5305, 6528, 4899, 1199, 7344, 6448, 4824, 9142, 412, 8982, 9351, 4206, 331, 1279, 402, 4173, 5052, 3659, 5862, 3685, 2543, 9281, 549, 9516, 1239, 2221, 2894, 4801, 8959, 4906, 9528, 7500, 1484, 5488, 2430, 3855, 4365, 6996, 2834, 5842, 825, 6799, 2517, 1214, 3568, 301, 8452, 5106, 5913, 5615, 2060, 7124, 3850, 1192, 4505, 4673, 9027, 7981, 5520, 616, 9031, 9945, 9951, 1269, 7531, 7142, 4896, 1159, 6521, 3684, 7082, 8691, 3377, 6464, 1559, 5034, 513, 6176, 5890, 7604, 3746, 8222, 4661, 2611, 80, 2545, 5692, 8431, 3073, 5925, 4305, 4705, 8160, 5320, 2348, 9881, 2954, 2337, 5234, 9978, 372, 3219, 6160, 9316, 7817, 6236, 2580, 5644, 6381, 3930, 8962, 486, 5000, 9819, 7596, 8813, 9750, 1430, 6474, 3668, 140, 9349, 2965, 5654, 2614, 7484, 4481, 3164, 4888, 4566, 9965, 1095, 2262, 5963, 6749, 9934, 3995, 9173, 1785, 1716, 1560, 8712, 5083, 3507, 152, 3830, 7351, 7839, 2548, 609, 7469, 2524, 2162, 9481, 1160, 2795, 989, 9053, 3274, 8981, 6446, 2754, 3075, 1339, 6534, 3787, 5635, 5573, 1555, 7828, 2288, 9057, 6844, 879, 4098, 5401, 2778, 7548, 8565, 5682, 2566, 2480, 8363, 8355, 8312, 9955, 6011, 2936, 8456, 9247, 9200, 3753, 8012, 3647, 1887, 6777, 7899, 6287, 3611, 1082, 6305, 102, 2410, 9304, 2715, 366, 3564, 3379, 9711, 5101, 541, 7985, 155, 328, 3008, 3513, 4733, 5898, 6104, 799, 8890, 4475, 2631, 8113, 3694, 2112, 6790, 1115, 4994, 5570, 672, 8926, 5917, 1964, 6278, 1588, 265, 4188, 1081, 7660, 348, 9633, 7547, 3986, 2186, 9724, 2887, 7882, 5792, 1297, 3322, 7509, 7565, 8102, 3703, 9444, 6494, 4576, 9783, 4299, 5863, 1823, 604, 5874, 9310, 8025, 6300, 9231, 9860, 2995, 9150, 5388, 8871, 7814, 8577, 5122, 2752, 3976, 6003, 2257, 4269, 6125, 5193, 2404, 7868, 4995, 287, 103, 9049, 753, 1965, 1029, 3627, 6478, 629, 5364, 8334, 1409, 7207, 7283, 1233, 3973, 6071, 6779, 1145, 8625, 3171, 5314, 3610, 4974, 8679, 4776, 1685, 4229, 6778, 7071, 843, 4919, 4765, 3870, 4804, 9340, 4143, 215, 1154, 3159, 6269, 893, 4912, 2811, 2212, 9433, 19, 9923, 3467, 506, 7995, 6030, 4515, 1782, 3730, 4732, 4929, 3401, 7639, 6721, 659, 3544, 675, 5780, 2055, 1070, 684, 341, 6696, 86, 5144, 5251, 1398, 2720, 9591, 8358, 2429, 8546, 2063, 6509, 1103, 3113, 4171, 4527, 5145, 8331, 2350, 8080, 4359, 3479, 6158, 2522, 3027, 4989, 2182, 6811, 1904, 5534, 5998, 4822, 2039, 4737, 9511, 6753, 2109, 1526, 2997, 7152, 3926, 8862, 1270, 3879, 8348, 5804, 5104, 5761, 2740, 3047, 2974, 6034, 3589, 6813, 6994, 9846, 8324, 2714, 7391, 8868, 5598, 7409, 7483, 8387, 429, 7960, 1305, 109, 6459, 6390, 6180, 4789, 8047, 751, 7741, 9563, 6492, 3235, 9549, 4055, 3432, 1971, 8273, 8529, 9308, 6458, 7698, 3300, 7774, 6699, 5834, 5343, 2610, 8686, 8930, 5043, 5702, 620, 4217, 5980, 9943, 1400, 3128, 4398, 8464, 5954, 6275, 4897, 6082, 7930, 6174, 5927, 7750, 7557, 6425, 3516, 4823, 4090, 587, 8641, 9101, 9663, 2600, 7784, 1581, 4539, 8999, 518, 9703, 8042, 6725, 3419, 3142, 5312, 2009, 4954, 3384, 1091, 696, 2597, 9638, 9159, 4002, 347, 8629, 6396, 3431, 4020, 5447, 8596, 415, 5848, 4817, 985, 5082, 8637, 322, 5192, 1083, 7787, 5129, 9002, 4966, 7091, 5309, 6982, 2110, 3924, 5810, 1733, 2104, 3846, 9070, 6400, 938, 6372, 8423, 6627, 7288, 4427, 9717, 4636, 9105, 1874, 7251, 9410, 5533, 3824, 49, 2498, 2378, 9064, 367, 5939, 2541, 1263, 7919, 9836, 4092, 730, 8604, 7347, 1387, 3785, 9046, 1249, 845, 7150, 4285, 7168, 1700, 6222, 4197, 974, 9913, 9689, 3297, 9992, 1428, 7314, 9139, 2011, 1293, 2770, 3173, 7973, 253, 5997, 7662, 8510, 440, 213, 2553, 7050, 8898, 7017, 6189, 4532, 9790, 6096, 5628, 4503, 3366, 6910, 6523, 4342, 7918, 5936, 2349, 8815, 7075, 4203, 555, 4227, 9991, 343, 6312, 7269, 8365, 1024, 5263, 339, 2503, 4094, 6516, 6973, 954, 3566, 8495, 9804, 735, 2988, 9054, 3502, 7884, 5676, 841, 943, 6346, 4454, 7748, 2639, 6169, 4880, 739, 3364, 7054, 3699, 6764, 4898, 5012, 422, 77, 9229, 6228, 6951, 1779, 4917, 6001, 52, 9465, 632, 4567, 3098, 9554, 2259, 8941, 9143, 468, 2132, 3796, 7962, 3160, 9005, 8533, 162, 511, 8583, 952, 6572, 5114, 1478, 3244, 5026, 5241, 6905, 1890, 681, 9780, 9223, 6465, 1238, 6968, 3546, 1719, 1692, 2181, 8359, 1738, 8131, 3241, 8927, 5342, 9344, 761, 3406, 1868, 9568, 2381, 544, 4241, 1244, 6081, 1126, 6526, 5709, 9264, 6864, 7241, 5287, 2719, 1587, 8576, 7934, 526, 5223, 7907, 4357, 2113, 6248, 7201, 8062, 2382, 6302, 5637, 7800, 3197, 6741, 1014, 470, 7499, 490, 5737, 116, 6655, 7860, 6962, 1150, 2741, 7526, 5286, 552, 4734, 6739, 6946, 1169, 5566, 9713, 4276, 2061, 6102, 3894, 1515, 7616, 3638, 9423, 3174, 9608, 9239, 1760, 5235, 4086, 5679, 4081, 1421, 1211, 7624, 6858, 4727, 5385, 6914, 8544, 546, 533, 8442, 4399, 7954, 4003, 5511, 3411, 578, 7179, 4977, 8626, 6354, 6107, 8262, 820, 9227, 7262, 4494, 1937, 5466, 2043, 2885, 2103, 1794, 1840, 9146, 7109, 8526, 8049, 4628, 3035, 105, 8956, 4693, 222, 3356, 1639, 2542, 7803, 2188, 4375, 7564, 1960, 7553, 5610, 9812, 3314, 757, 5408, 2638, 1463, 9964, 9157, 1914, 8767, 7921, 585, 5618, 8793, 2847, 6149, 8108, 5602, 7432, 9370, 2383, 5231, 860, 3245, 2391, 6876, 4938, 3429, 5036, 18, 2070, 9137, 1281, 3600, 9339, 9977, 4336, 5914, 5117, 3354, 7, 3301, 5797, 1479, 532, 1745, 8489, 3111, 5005, 2616, 6254, 4589, 3572, 9387, 1120, 9944, 7118, 6466, 1999, 5460, 2516, 1198, 4382, 8733, 4698, 7461, 4262, 4385, 928, 4889, 3256, 5560, 4104, 9317, 7512, 4813, 5394, 4761, 5208, 5728, 5267, 6533, 2161, 562, 4070, 667, 1352, 6299, 5672, 2443, 4107, 5336, 9358, 5942, 3966, 6632, 4109, 1844, 9796, 8185, 4940, 5458, 4584, 4877, 2816, 864, 1230, 7095, 3992, 3705, 22, 5038, 4993, 8417, 4330};
int _RAZREDI[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
