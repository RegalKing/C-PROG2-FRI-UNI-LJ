#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {2863, 516, 1825, 9351, 967, 9760, 2844, 7484, 7396, 3474, 9281, 5967, 4693, 2020, 1135, 8371, 9083, 7785, 8760, 1354, 8494, 7061, 5580, 8169, 8075, 8147, 5343, 9344, 6354, 736, 9308, 1636, 2441, 7863, 2125, 4969, 396, 718, 8928, 4289, 9820, 457, 6622, 9995, 5755, 5166, 1070, 6183, 5357, 2998, 4287, 2306, 8505, 6431, 9340, 5621, 4174, 5608, 4169, 869, 7371, 2397, 5280, 5735, 8683, 3085, 2189, 3088, 2659, 4859, 7700, 8268, 7789, 1602, 9844, 2493, 4171, 5402, 2631, 4783, 494, 2246, 9107, 4369, 8495, 1322, 8064, 6499, 9652, 3410, 2229, 4812, 3356, 6192, 4265, 3712, 1435, 7694, 6350, 2925, 6512, 9174, 3322, 7732, 9736, 4833, 7470, 9610, 4402, 20, 2367, 3638, 6579, 979, 6168, 8215, 59, 4696, 7388, 5989, 8493, 1186, 1877, 6265, 2581, 5719, 693, 9605, 5409, 5212, 9756, 5647, 8491, 1188, 6569, 4939, 7788, 4092, 2759, 271, 8152, 7240, 9424, 5453, 8096, 3521, 2045, 5971, 3243, 9691, 9073, 1932, 5103, 7514, 6567, 2059, 575, 3775, 8373, 7528, 8569, 7305, 5567, 1404, 4852, 991, 4104, 7689, 6327, 2408, 2569, 878, 3417, 7971, 2959, 5369, 6059, 1481, 3027, 2758, 1691, 9442, 7167, 7675, 6085, 264, 3489, 6140, 2977, 536, 1260, 612, 6998, 2104, 1959, 199, 1474, 3281, 4277, 789, 9502, 7480, 1675, 3903, 3462, 5714, 4140, 9271, 1039, 7487, 2894, 8233, 9132, 84, 833, 7377, 2847, 1516, 8187, 6722, 5333, 3998, 898, 3001, 7952, 9686, 5723, 3143, 1567, 8151, 8512, 9789, 3357, 2046, 2772, 6313, 9027, 1503, 1434, 2949, 2740, 9511, 3449, 8653, 2800, 3779, 6584, 2344, 3123, 2085, 380, 3002, 49, 6018, 2562, 2316, 4139, 7840, 8162, 6000, 9320, 3870, 6726, 4586, 1618, 5939, 2590, 786, 1107, 3706, 9229, 3622, 2282, 210, 1295, 4054, 3960, 9282, 2795, 1568, 3054, 1449, 3364, 5359, 4284, 7384, 2693, 1579, 3103, 6686, 7248, 4331, 3070, 9177, 9559, 9299, 9407, 2380, 5482, 2432, 9828, 6691, 5575, 157, 737, 843, 4863, 8335, 1529, 6092, 7346, 7446, 2950, 5139, 2605, 3333, 3379, 7617, 4377, 9960, 5110, 4625, 9066, 1114, 8437, 2456, 1920, 6859, 2338, 4401, 4193, 9219, 7890, 6008, 9071, 2009, 4184, 2259, 8537, 5577, 537, 3593, 1001, 9542, 2918, 1707, 6635, 2848, 3190, 2991, 115, 5208, 6940, 873, 3610, 578, 8588, 6916, 7177, 9130, 2610, 3105, 1973, 5188, 9609, 3212, 8560, 9464, 3996, 2192, 4381, 5583, 1513, 957, 6263, 8074, 67, 2781, 906, 8255, 3693, 4786, 9216, 4692, 8945, 9708, 3869, 63, 1338, 1391, 9314, 7692, 4357, 3163, 3107, 4672, 9982, 6318, 3329, 4747, 7622, 7334, 6057, 731, 7953, 3289, 2981, 4722, 5403, 9530, 6338, 5218, 1133, 9868, 6348, 4499, 3745, 9671, 1681, 9131, 4557, 9648, 866, 5420, 2687, 1720, 2181, 8906, 8112, 8189, 504, 5725, 234, 1011, 4860, 1650, 2235, 8859, 3097, 9222, 8094, 1380, 7241, 8317, 3128, 836, 2383, 9631, 3812, 4996, 4713, 8372, 1465, 8209, 3881, 3049, 6139, 5446, 9651, 6942, 7493, 3514, 2764, 8105, 7187, 6147, 164, 8068, 2933, 1810, 5754, 3266, 9398, 80, 487, 9346, 4928, 4153, 6960, 5052, 4700, 4301, 6789, 7921, 5742, 4341, 6497, 1470, 6154, 9039, 5014, 626, 7541, 2553, 8729, 2148, 1732, 3548, 4190, 4945, 9240, 7986, 9703, 2836, 8104, 2187, 3746, 1015, 1104, 3274, 9526, 2768, 7434, 1472, 7923, 1861, 8124, 6607, 5340, 9193, 7490, 9188, 9088, 8485, 5465, 867, 6504, 8521, 3046, 7260, 1710, 6571, 1251, 8903, 3273, 8701, 4826, 2555, 1672, 1836, 3628, 9807, 874, 3708, 750, 5370, 4048, 783, 5491, 829, 4332, 1088, 1119, 1050, 4340, 8925, 7282, 7469, 3302, 1269, 9779, 506, 7451, 6745, 6632, 1103, 477, 6899, 5008, 8515, 1127, 9622, 3392, 7198, 5979, 96, 1212, 3682, 7237, 3149, 1751, 1125, 9393, 5492, 2909, 5500, 8292, 9743, 7412, 1904, 5235, 704, 3645, 5833, 2040, 3279, 8728, 3432, 9068, 6970, 6040, 6161, 5442, 2043, 6236, 633, 4448, 4469, 8228, 8453, 7831, 1717, 8397, 8229, 1537, 6554, 2073, 930, 9970, 3308, 1733, 1213, 9746, 9153, 5718, 8946};
int _RAZREDI[] = {0, 0, 1, 2, 2, 0, 2, 0, 3, 2, 4, 5, 6, 7, 8, 9, 10, 11, 12, 12, 13, 14, 14, 15, 16, 14, 2, 17, 15, 18, 12, 19, 8, 20, 9, 15, 21, 22, 12, 23, 24, 2, 5, 25, 26, 23, 27, 19, 9, 28, 29, 2, 2, 0, 13, 30, 31, 21, 5, 0, 2, 13, 12, 32, 0, 31, 33, 34, 35, 36, 37, 5, 38, 39, 12, 40, 41, 42, 24, 43, 12, 44, 0, 2, 32, 45, 46, 15, 12, 28, 47, 15, 48, 49, 48, 50, 51, 0, 52, 12, 20, 53, 54, 2, 36, 55, 56, 57, 15, 58, 5, 43, 2, 8, 59, 0, 15, 60, 61, 2, 12, 2, 11, 0, 53, 15, 62, 63, 64, 65, 60, 66, 26, 67, 68, 69, 2, 11, 70, 28, 71, 26, 72, 73, 74, 75, 11, 12, 23, 76, 77, 35, 2, 78, 1, 74, 79, 80, 81, 82, 5, 13, 83, 84, 85, 2, 32, 0, 13, 86, 2, 87, 0, 88, 86, 89, 90, 91, 55, 0, 19, 92, 2, 93, 0, 31, 2, 94, 12, 5, 0, 95, 96, 12, 97, 98, 99, 100, 101, 12, 102, 15, 26, 12, 103, 69, 104, 28, 105, 106, 107, 12, 108, 109, 110, 12, 111, 28, 112, 113, 114, 115, 3, 58, 116, 0, 117, 118, 119, 92, 120, 102, 121, 122, 123, 28, 44, 124, 125, 41, 126, 83, 8, 127, 128, 2, 129, 130, 1, 43, 26, 5, 131, 31, 8, 132, 133, 134, 135, 136, 110, 137, 138, 24, 133, 38, 0, 139, 140, 15, 40, 141, 142, 130, 83, 143, 86, 122, 144, 85, 119, 127, 145, 12, 146, 65, 2, 138, 147, 127, 43, 12, 49, 148, 109, 2, 149, 116, 40, 150, 151, 152, 26, 153, 149, 154, 149, 13, 155, 156, 11, 81, 0, 0, 100, 157, 31, 41, 32, 158, 57, 85, 159, 160, 161, 162, 8, 163, 164, 129, 165, 55, 166, 69, 0, 167, 162, 168, 169, 55, 8, 170, 171, 172, 173, 13, 139, 129, 0, 174, 175, 176, 177, 12, 178, 15, 179, 64, 39, 180, 181, 182, 156, 183, 184, 151, 5, 140, 31, 185, 118, 186, 113, 108, 161, 187, 183, 188, 189, 122, 40, 190, 191, 40, 28, 72, 12, 0, 192, 193, 182, 18, 194, 161, 195, 109, 196, 173, 197, 67, 0, 11, 192, 164, 48, 11, 198, 92, 2, 199, 200, 100, 201, 202, 2, 203, 2, 41, 8, 204, 205, 206, 207, 35, 15, 208, 209, 0, 210, 211, 19, 2, 142, 92, 0, 212, 180, 213, 22, 214, 215, 216, 217, 0, 20, 26, 218, 219, 220, 221, 2, 7, 2, 42, 222, 223, 140, 208, 149, 224, 130, 131, 225, 226, 227, 228, 8, 229, 230, 12, 63, 231, 232, 233, 193, 234, 235, 236, 237, 238, 239, 148, 240, 2, 241, 242, 40, 243, 244, 245, 246, 15, 2, 81, 247, 248, 109, 249, 2, 247, 131, 250, 134, 89, 2, 13, 251, 252, 108, 66, 104, 92, 208, 253, 149, 103, 2, 254, 12, 255, 256, 5, 257, 258, 259, 0, 110, 208, 104, 260, 229, 254, 261, 8, 83, 262, 0, 102, 263, 12, 264, 265, 2, 66, 0, 14, 266, 29, 157, 146, 267, 268, 19, 269, 42, 158, 270, 2, 271, 203, 272, 14, 273, 72, 274, 275, 108, 40, 276, 156, 277, 101, 81, 278, 152, 11, 279, 0, 123, 41, 8, 280, 281, 2, 282, 283, 28, 2, 284, 285, 286, 287, 12, 8, 226, 288, 289, 290, 291, 86, 292, 293, 294, 201, 5, 295, 15, 0, 296, 46, 28, 297, 2, 298, 299, 63, 300, 0, 215, 301, 0, 302, 303, 304, 86, 305};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
