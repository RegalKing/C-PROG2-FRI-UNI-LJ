#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {4628, 4832, 9390, 6349, 5490, 2665, 7162, 2366, 2991, 5842, 9487, 4107, 2278, 2046, 2820, 761, 2980, 9161, 7359, 7065, 3732, 5988, 8056, 7574, 5509, 5068, 7312, 9821, 8671, 9884, 6538, 4708, 9004, 8176, 9443, 664, 6495, 2529, 9603, 9626, 9654, 5892, 7807, 8210, 7940, 9134, 4336, 2829, 6596, 9090, 7083, 1704, 5616, 2814, 1057, 1652, 137, 6850, 6047, 1163, 5748, 5725, 3680, 8427, 3865, 9421, 9142, 7051, 4165, 2149, 7296, 9919, 772, 2223, 6634, 4535, 5092, 6849, 8308, 9905, 5206, 4179, 4767, 7203, 4255, 5955, 3670, 9693, 6250, 9522, 1765, 8041, 7456, 3878, 5107, 1487, 759, 7313, 7201, 2879, 6085, 4111, 1772, 4199, 9290, 3600, 2231, 6241, 872, 9021, 7605, 5551, 7428, 610, 3342, 3983, 6287, 4547, 376, 9405, 7697, 4129, 4048, 3343, 6636, 4447, 2975, 5968, 2741, 4570, 7241, 6962, 1383, 9097, 6782, 5542, 2249, 3341, 3146, 4185, 801, 9548, 8804, 7638, 1457, 4523, 3527, 6615, 7779, 5887, 6491, 9250, 653, 3281, 6854, 4933, 7206, 8753, 2696, 8896, 2167, 3169, 8760, 4859, 1507, 5151, 72, 4542, 413, 4177, 1905, 6013, 1389, 4903, 2794, 1812, 7843, 1889, 5668, 5852, 9007, 8684, 6781, 2086, 6713, 7677, 5980, 9636, 4077, 3959, 7032, 6153, 8328, 8460, 5223, 7298, 782, 1094, 9126, 7027, 1075, 2042, 5183, 5011, 8737, 4740, 5671, 4492, 5792, 7585, 8700, 5173, 8504, 9013, 9284, 5276, 196, 2337, 5336, 1367, 900, 455, 1858, 7881, 2979, 9871, 2609, 7145, 8073, 8055, 4291, 2116, 7905, 9543, 9376, 1003, 4069, 5787, 2323, 9277, 2788, 5404, 4277, 2298, 8318, 3636, 6991, 5884, 1474, 6442, 5203, 2316, 8500, 1930, 4383, 7778, 6874, 4372, 2094, 1471, 9297, 9977, 6597, 5984, 1776, 3071, 7353, 8663, 4094, 8713, 5918, 6689, 5686, 4768, 6516, 2169, 6222, 9014, 4155, 6677, 2847, 1103, 2383, 1841, 1784, 7714, 9814, 8948, 5202, 1272, 2670, 3051, 2739, 9374, 1028, 5103, 2797, 4009, 2381, 2310, 3584, 7551, 6335, 2146, 3266, 3257, 6907, 3373, 4989, 2857, 3634, 207, 1967, 4841, 6859, 5779, 9103, 3423, 9230, 4081, 9375, 9274, 7508, 3338, 6968, 6675, 7232, 4812, 331, 8680, 2605, 1453, 8649, 2128, 4087, 7004, 7641, 5585, 8194, 982, 7007, 4470, 5473, 496, 8209, 7931, 4422, 2826, 4389, 4434, 6358, 1269, 1193, 4529, 4551, 6092, 5142, 4977, 5566, 2122, 7373, 8578, 2962, 1624, 8621, 7036, 7217, 4809, 2706, 4563, 8878, 2051, 846};
int _RAZREDI[] = {0, 0, 0, 0, 1, 2, 3, 3, 1, 0, 3, 0, 2, 4, 4, 0, 3, 3, 5, 3, 1, 4, 0, 3, 4, 0, 1, 4, 0, 4, 1, 6, 7, 1, 8, 0, 1, 4, 9, 10, 0, 0, 0, 4, 4, 3, 4, 11, 4, 0, 12, 13, 0, 3, 14, 15, 4, 16, 17, 2, 18, 19, 0, 1, 1, 1, 20, 0, 0, 0, 21, 22, 3, 4, 3, 23, 24, 16, 15, 0, 9, 7, 25, 4, 26, 27, 2, 1, 9, 24, 8, 6, 9, 1, 8, 1, 0, 6, 3, 28, 29, 30, 25, 1, 9, 31, 32, 33, 15, 5, 34, 35, 9, 3, 0, 29, 2, 36, 25, 3, 3, 37, 4, 25, 38, 0, 1, 0, 39, 40, 41, 0, 42, 3, 9, 4, 9, 3, 25, 43, 3, 5, 44, 1, 8, 3, 3, 24, 0, 45, 5, 46, 47, 1, 48, 9, 3, 45, 6, 49, 43, 3, 50, 51, 1, 32, 52, 5, 0, 53, 54, 0, 45, 55, 56, 4, 50, 57, 2, 25, 58, 29, 59, 0, 34, 6, 60, 3, 19, 11, 0, 61, 50, 62, 0, 63, 57, 64, 4, 29, 9, 53, 9, 3, 32, 0, 65, 25, 66, 67, 68, 69, 10, 9, 39, 70, 71, 72, 8, 0, 73, 59, 74, 75, 4, 9, 5, 25, 76, 77, 65, 0, 78, 79, 80, 81, 4, 5, 25, 64, 82, 83, 32, 12, 84, 85, 86, 0, 3, 46, 3, 87, 6, 88, 46, 2, 89, 90, 63, 0, 91, 92, 93, 32, 94, 0, 4, 95, 2, 96, 97, 98, 99, 1, 12, 0, 100, 35, 66, 101, 6, 34, 102, 15, 103, 104, 105, 47, 3, 9, 106, 107, 58, 15, 0, 4, 4, 108, 2, 76, 71, 3, 109, 1, 0, 109, 110, 111, 112, 6, 24, 0, 1, 3, 48, 1, 113, 4, 114, 115, 116, 33, 1, 117, 9, 97, 3, 118, 35, 119, 0, 58, 120, 71, 121, 113, 65, 0, 9, 122, 106, 106, 6, 4, 123, 124, 11, 3, 125, 2, 126, 42, 55, 42, 127, 99, 128, 15, 1, 0, 129, 0, 130, 131, 58, 132, 16, 15, 76, 84, 133, 134, 1};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
