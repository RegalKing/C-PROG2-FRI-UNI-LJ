#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {7296, 3322, 8909, 6940, 2599, 6014, 90, 7391, 2671, 2391, 5476, 1375, 6079, 9064, 6718, 2958, 4640, 4201, 4932, 2911, 2924, 144, 3650, 2160, 7536, 6922, 7529, 4396, 1084, 3186, 3126, 347, 9301, 8497, 7081, 9583, 9474, 3012, 203, 3198, 7516, 3706, 4433, 4554, 6567, 1010, 7818, 1469, 466, 1906, 8338, 2079, 9259, 198, 5362, 5177, 6621, 9884, 6059, 194, 3744, 7777, 8811, 3125, 8969, 7646, 7513, 7555, 3376, 552, 8029, 7234, 9288, 8772, 3206, 323, 7727, 5020, 6224, 1513, 8298, 3456, 3054, 705, 1493, 1233, 9756, 1340, 4465, 8467, 8268, 8282, 4680, 7493, 9860, 5668, 3208, 1234, 7986, 1026, 2730, 2354, 8113, 6565, 1239, 8197, 3605, 5933, 5427, 7698, 4981, 4450, 4525, 8080, 4188, 9891, 9358, 1621, 56, 1790, 6317, 5058, 8225, 5530, 4018, 5920, 6753, 4867, 4082, 945, 3775, 1412, 1676, 7928, 9908, 813, 7438, 3184, 3954, 1594, 3265, 5264, 9794, 618, 3122, 4872, 5897, 2442, 1901, 6912, 9968, 5678, 1263, 1450, 5037, 2885, 6763, 7071, 3917, 8769, 6603, 7084, 8355, 1911, 8526, 3678, 4310, 6994, 9312, 2337, 8654, 3500, 2135, 3935, 7864, 875, 8333, 9088, 1771, 4171, 4434, 2133, 3787, 9184, 3873, 4927, 6245, 1448, 2430, 1401, 8963, 9320, 4148, 6093, 440, 8449, 6071, 703, 9371, 3791, 1917, 3108, 8130, 2615, 7411, 3242, 946, 4049, 8911, 6714, 8401, 2661, 1760, 1130, 8540, 8060, 8097, 4730, 870, 9679, 6635, 1577, 8191, 1192, 1005, 9649, 5070, 6551, 2653, 6204, 6559, 80, 6275, 4810, 4501, 2518, 4376, 1345, 6449, 5555, 2753, 4808, 3653, 1138, 5467, 1111, 7245, 7302, 943, 6971, 760, 4381, 9876, 6501, 1288, 1525, 1172, 6425, 2758, 225, 9142, 8920, 7431, 5279, 2842, 3519, 8345, 1574, 6227, 6063, 651, 4025, 682, 3319, 5491, 8796, 1140, 3011, 794, 403, 7752, 1442, 7979, 4205, 6470, 5033, 7128, 5803, 195, 9098, 6094, 3441, 2451, 608, 5513, 4952, 6182, 3675, 572, 1941, 4446, 5822, 8618, 8390, 9693, 1562, 6405, 5150, 4655, 4968, 3382, 5913, 1143, 9222, 4569, 9877, 5908, 3081, 7766, 2975, 5687, 9941, 4084};
int _RAZREDI[] = {0, 1, 1, 2, 3, 0, 4, 1, 1, 5, 6, 5, 7, 7, 1, 8, 5, 1, 9, 2, 2, 10, 11, 3, 12, 5, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 10, 29, 3, 30, 27, 29, 31, 32, 28, 16, 33, 34, 34, 35, 36, 37, 38, 39, 7, 40, 29, 41, 42, 7, 43, 35, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 10, 31, 59, 60, 61, 62, 21, 30, 63, 0, 64, 24, 65, 66, 67, 37, 68, 59, 0, 69, 70, 30, 71, 72, 73, 74, 30, 68, 75, 76, 77, 35, 78, 79, 66, 80, 1, 81, 82, 64, 4, 66, 83, 31, 84, 46, 85, 86, 34, 87, 88, 89, 23, 34, 90, 91, 92, 63, 93, 66, 94, 58, 68, 95, 96, 97, 59, 30, 35, 98, 99, 74, 100, 101, 70, 102, 103, 104, 105, 35, 106, 66, 29, 107, 108, 0, 1, 0, 109, 7, 62, 110, 111, 112, 35, 46, 113, 114, 115, 116, 58, 117, 118, 119, 120, 89, 0, 121, 1, 122, 123, 124, 3, 125, 23, 126, 127, 128, 115, 9, 129, 130, 131, 49, 132, 10, 98, 133, 35, 134, 106, 56, 135, 63, 136, 70, 104, 137, 138, 29, 14, 139, 140, 141, 142, 143, 88, 144, 145, 146, 147, 122, 148, 1, 54, 44, 60, 88, 23, 0, 149, 150, 151, 152, 10, 153, 154, 155, 46, 1, 69, 94, 156, 157, 97, 46, 158, 3, 159, 160, 161, 5, 10, 162, 44, 36, 163, 150, 164, 165, 159, 0, 166, 167, 168, 169, 170, 29, 171, 172, 54, 173, 88, 128, 161, 3, 174, 175, 30, 176, 177, 178, 153, 115, 35, 70, 179, 180, 181, 145, 182, 173, 83, 183, 184, 185, 186, 187, 1, 188, 36, 88, 189, 88, 46, 190, 94, 191, 153, 31};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
