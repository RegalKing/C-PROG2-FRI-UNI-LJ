#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {8123, 7191, 4599, 5631, 8388, 7909, 8236, 1266, 1972, 6342, 1934, 1450, 9750, 5813, 6096, 9354, 2164, 8495, 9781, 6836, 8437, 8794, 7145, 4158, 7014, 9722, 3340, 2900, 733, 7505, 8657, 1162, 5682, 515, 3625, 1129, 1349, 2631, 8638, 1843, 2229, 2247, 525, 2133, 483, 5757, 7949, 2072, 1660, 5391, 5513, 1027, 9871, 496, 9612, 6713, 2775, 8485, 3198, 7921, 6219, 1939, 8608, 1307, 4850, 5726, 4403, 164, 7249, 1763, 5646, 6825, 5323, 7306, 5367, 7780, 99, 5803, 3742, 8630, 691, 10, 7907, 1011, 7288, 4843, 2413, 2254, 4710, 4408, 5503, 9603, 1124, 1410, 2407, 9762, 7212, 2017, 9182, 1483, 9396, 6049, 7439, 22, 8769, 1471, 1198, 1385, 8805, 8748, 3605, 6341, 5313, 6937, 3303, 4764, 8750, 1288, 3999, 1698, 1133, 7481, 5012, 5827, 6111, 3457, 6177, 2565, 3289, 2561, 9760, 886, 221, 2930, 9418, 9875, 6986, 2641, 5088, 5564, 7567, 2149, 742, 9336, 5655, 7411, 3573, 7025, 6206, 1906, 2503, 3525, 2804, 2748, 3451, 5059, 2499, 330, 537, 9866, 1020, 9293, 7955, 3309, 922, 1371, 7977, 8158, 7164, 2288, 9716, 149, 352, 7706, 9874, 7077, 1493, 2920, 7894, 6472, 3049, 1702, 4149, 7674, 5086, 8484, 8665, 849, 1243, 8118, 4077, 6040, 7516, 9961, 3316, 3845, 7030, 1046, 3174, 1571, 6384, 8711, 1130, 131};
int _RAZREDI[] = {0, 0, 0, 1, 2, 0, 3, 4, 5, 6, 7, 4, 0, 4, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 7, 12, 18, 19, 20, 21, 4, 8, 22, 23, 24, 25, 26, 27, 28, 29, 0, 30, 31, 32, 0, 33, 34, 35, 28, 36, 20, 37, 38, 39, 40, 41, 42, 43, 44, 45, 12, 46, 47, 48, 49, 12, 50, 32, 51, 52, 53, 54, 35, 5, 55, 56, 21, 57, 58, 56, 35, 59, 60, 61, 62, 33, 63, 64, 65, 66, 67, 68, 69, 70, 71, 48, 72, 59, 14, 73, 74, 75, 17, 76, 77, 78, 19, 79, 80, 81, 82, 14, 32, 83, 84, 85, 86, 19, 56, 87, 88, 10, 89, 90, 91, 82, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 27, 104, 105, 106, 107, 28, 108, 109, 4, 110, 111, 112, 113, 114, 25, 115, 116, 0, 104, 117, 118, 119, 120, 73, 39, 121, 122, 19, 56, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 42, 135, 126, 136, 137, 42, 21, 138, 139, 92, 140, 141, 7, 142, 143, 144, 145, 146, 147, 27, 32, 148, 149, 44, 150};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
