#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {8282, 4193, 2939, 631, 6047, 8749, 8913, 9198, 5939, 8247, 181, 463, 5058, 8845, 5417, 5049, 1686, 1043, 3393, 7957, 5059, 9885, 6692, 6731, 5251, 5281, 8848, 4886, 9397, 7751, 5863, 3430, 6732, 8275, 2403, 9443, 7209, 1368, 7734, 8233, 9155, 2978, 5162, 831, 8006, 1387, 24, 2966, 5363, 8256, 3943, 8050, 5638, 3825, 2602, 6574, 3925, 3172, 898, 9323, 1582, 3419, 5807, 6842, 4943, 8883, 3494, 5925, 9864, 9719, 5781, 3629, 9279, 6527, 353, 5512, 4227, 5233, 7346, 6788, 2896, 7171, 7226, 3285, 7977, 768, 9895, 6561, 9650, 5483, 9464, 1223, 2975, 7611, 869, 7616, 7384, 3975, 7845, 4958, 9958, 2851, 3258, 4901, 8804, 736, 1131, 7370, 7180, 1290, 4840, 350, 8152, 372, 2132, 9888, 462, 3377, 5488, 2279, 6071, 5465, 8676, 83, 7814, 5927, 2247, 3652, 3249, 6752, 5147, 32, 6577, 8365, 5150, 1144, 7204, 684, 730, 1736, 1537, 8160, 8554, 2719, 742, 231, 1846, 2907, 2822, 9321, 149, 5368, 6373, 3627, 8182, 2187, 107, 8515, 8703, 5724, 2409, 9116, 2490, 6739, 4993, 9501, 2095, 2496, 5016, 824, 7591, 6849, 171, 1285, 169, 8608, 7635, 3806, 3079, 8569, 9091, 8678, 196, 9961, 9709, 1901, 8754, 6347, 4970, 6137, 7505, 6525, 8238, 4110, 4489, 2450, 6049, 6156, 7105, 7728, 6296, 4362, 3950, 4515, 7969, 9595, 2740, 5753, 5596, 5674, 7869, 3977, 9167, 3379, 1315, 8390, 3115, 9979, 1902, 2474, 7907, 7417, 8511, 7493, 6082, 1184, 5285, 3835, 781, 640, 1093, 7193, 8987, 986, 7862, 7515, 2372, 5592, 305, 6693, 4184, 1482, 6821, 7494, 285, 1009, 8041, 308, 5662, 9300, 899, 623, 97, 6448, 1996, 3105, 9095, 2825, 1954, 9101, 1566, 6061, 4997, 8068, 9857, 9074, 8547, 361, 8583, 6679, 3763, 9117, 3708, 4814, 5484, 6051, 7297, 3431, 3655, 5048, 2627, 2050, 2842, 1923, 750, 1470, 1676, 4868, 4654, 3691, 7865, 5732, 4199, 1283, 5256, 3205, 4995, 111, 3923, 392, 7961, 9460, 3235, 1275, 2537, 5787, 7902, 2034, 8499, 7392, 2397, 8455, 8260, 7133, 4147, 376, 7051, 7174, 8378, 1989, 9886, 9779, 7536, 3583, 1893, 3723, 6725, 7471, 4481, 3151, 5808, 8968, 8907, 5823, 8971, 3781, 6768, 1594, 2765, 3212, 8210, 1836, 1587, 5918, 7955, 9746, 1308, 4061, 1455, 2295, 8405, 7389, 4945, 8862, 9079, 6456, 1253, 4031, 9023, 1130, 3424, 6475, 6523, 3048, 1554, 8841, 3242, 9404, 763, 8091, 3173, 5693, 7964, 3168, 2012, 1406, 219, 9180, 5577, 1171, 8178, 3131, 2435, 4028, 3075, 7885, 4427, 7770, 8147, 4417, 6416, 967, 4544, 5595};
int _RAZREDI[] = {0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 3, 4, 0, 5, 0, 4, 0, 6, 0, 0, 7, 8, 0, 9, 4, 0, 0, 10, 8, 11, 2, 7, 0, 7, 4, 7, 0, 5, 12, 0, 13, 3, 9, 0, 0, 14, 15, 1, 0, 0, 0, 2, 2, 7, 16, 7, 0, 17, 0, 0, 0, 9, 0, 0, 0, 5, 0, 0, 5, 2, 0, 0, 18, 12, 19, 0, 20, 9, 0, 0, 0, 7, 0, 0, 21, 2, 22, 23, 0, 24, 5, 25, 0, 9, 26, 3, 0, 2, 3, 0, 15, 5, 0, 0, 0, 9, 0, 27, 12, 26, 0, 28, 29, 0, 5, 0, 5, 0, 0, 29, 30, 9, 0, 0, 9, 0, 0, 30, 0, 0, 1, 0, 2, 9, 31, 0, 32, 33, 5, 9, 0, 0, 34, 30, 7, 0, 13, 0, 9, 1, 26, 35, 12, 5, 4, 0, 7, 0, 0, 20, 0, 0, 0, 0, 4, 32, 0, 23, 36, 8, 0, 37, 0, 0, 0, 5, 5, 0, 0, 0, 5, 5, 7, 38, 0, 0, 39, 40, 0, 0, 7, 41, 30, 0, 0, 42, 43, 44, 45, 7, 29, 9, 46, 30, 7, 47, 0, 29, 0, 29, 2, 0, 0, 47, 0, 14, 48, 1, 27, 49, 50, 51, 2, 4, 7, 9, 0, 46, 0, 0, 29, 0, 20, 52, 0, 0, 7, 7, 53, 28, 54, 0, 0, 33, 0, 55, 0, 0, 56, 5, 0, 30, 0, 19, 57, 0, 0, 0, 0, 0, 0, 0, 58, 0, 26, 59, 0, 5, 13, 5, 0, 5, 1, 60, 7, 9, 0, 61, 0, 5, 19, 21, 7, 50, 13, 0, 13, 0, 0, 9, 0, 0, 62, 0, 5, 0, 5, 63, 5, 28, 29, 30, 24, 34, 8, 60, 64, 65, 66, 67, 68, 32, 29, 0, 4, 41, 46, 0, 69, 2, 70, 0, 9, 53, 1, 26, 20, 47, 9, 71, 0, 72, 7, 73, 45, 27, 53, 74, 1, 21, 7, 66, 75, 2, 0, 0, 0, 0, 76, 2, 69, 0, 46, 68, 0, 77, 78, 0, 0, 17, 30, 0, 4, 0, 79, 41, 0, 0, 0, 5, 0, 80, 81, 82, 26, 79, 3, 0, 83, 52, 9, 2, 84, 30, 3, 85, 0, 47, 0, 0, 0, 47, 5};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
