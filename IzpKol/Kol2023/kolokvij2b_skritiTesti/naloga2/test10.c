#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {368, 2028, 3465, 6633, 7603, 796, 5454, 8056, 6169, 5295, 705, 5519, 3699, 8287, 1525, 2123, 1881, 8786, 2801, 6215, 5549, 5427, 8881, 7808, 8621, 3307, 3459, 2875, 9586, 4370, 3815, 8750, 3485, 6753, 3230, 2126, 4479, 8660, 8850, 7567, 3089, 6238, 3087, 4000, 3902, 4648, 5426, 7373, 5867, 263, 4540, 2871, 5904, 6902, 6524, 8538, 1033, 1404, 8855, 9551, 6086, 4073, 1235, 5802, 6434, 3454, 7916, 1203, 905, 9943, 9954, 8640, 2355, 1659, 3238, 1273, 6374, 542, 3352, 1556, 2994, 580, 1927, 6120, 618, 6279, 6340, 12, 9824, 1876, 2005, 5575, 8132, 2563, 6605, 6376, 8693, 9325, 963, 8269, 9447, 2949, 9187, 8362, 8089, 8551, 2090, 8535, 8343, 7522, 4152, 4850, 429, 9466, 2719, 1390, 9388, 4736, 2445, 6263, 2622, 256, 2428, 2114, 8462, 3945, 2950, 1687, 4709, 6809, 7140, 339, 7711, 6937, 1758, 2535, 6006, 6758, 4576, 4677, 1066, 9688, 5752, 4731, 6522, 4307, 9671, 8204, 4684, 5659, 493, 5049, 110, 8583, 7849, 5863, 3835, 7209, 5868, 3997, 2128, 8136, 5399, 5910, 4896, 7606, 60, 2359, 7930, 2025, 3076, 293, 5074, 820, 8398, 4879, 722, 8717, 6804, 6089, 8485, 6050, 9615, 4409, 6416, 3144, 5099, 8810, 1134, 401, 1215, 5177, 3886, 566, 283, 794, 5784, 1849, 3804, 8690, 331, 5831, 8852, 9257, 70, 5809, 4807, 2215, 8740, 1343, 5958, 3796, 5042, 1321, 5312, 361, 3456, 7607, 4403, 1913, 3603, 9082, 3643, 4345, 9622, 7504, 136, 3583, 6552, 1855, 3104, 8489, 7053, 6318, 1947, 188, 5124, 1358, 7920, 9601, 4734, 1841, 7627, 6644, 4449, 7152, 9809, 3601, 7527, 728, 1144, 6210, 2513, 6467, 7597, 7400, 1857, 9845, 3986, 4786, 4328, 6777, 8771, 740, 5790, 1697, 4121, 4057, 5098, 8588, 5647, 8668, 9005, 7861, 2631, 6770, 3570, 9941, 808, 5328, 9444, 1635, 832, 583, 7846, 1696, 9630, 3573, 3119, 4424, 5944, 3794, 7124, 4396, 5303, 1792, 9446, 8348, 7310, 1848, 1210, 2356, 1057, 9898, 9674, 4136, 6259, 8059, 2601, 4832, 770, 7461, 4450, 6938, 7999, 8749, 1191, 8353, 7686, 4686, 7496, 7568, 6267, 6626, 4634, 6448, 9829, 2701, 6827, 4061, 8468, 4997, 1415, 7284, 3411, 2029, 7342, 2516, 7317, 4617, 8460, 927, 7275, 7407, 651, 6579, 4812, 2272, 1003, 9573, 9149, 7898, 1002, 370, 2760, 1603, 7869, 5302, 4525, 1329, 3644, 861, 8910, 7174, 6943, 9001, 2208, 3050, 3987, 1292, 974, 4790, 488, 3736, 4213, 7814, 6837, 8518, 5404, 6545, 3425, 6370, 3915, 8407, 2141, 4951, 2965, 1074, 7918, 9042, 3745, 7830, 1445, 3790, 9204, 9266, 9923, 746, 8779, 2928, 1547, 9762, 3418, 1379, 7728, 3873, 9350, 8380, 1902, 2145, 9405, 6196, 4857, 6748, 7144, 8181, 1958, 2565, 9865, 2947, 3812, 510, 8607, 2688, 7886, 5350, 3367, 1494, 8012, 8782, 6801, 5434, 7801, 1095, 6783, 5931, 9677, 3270, 1020, 253, 4678, 7495, 9117, 8812, 8943, 3866, 8161, 8200, 842, 5418, 6466, 4028, 4640, 3240, 980, 1224, 4958, 9219, 2161, 3334, 9761, 5207, 6821, 7878, 1500, 1623, 7812, 845, 6874, 5370, 2886, 2136, 5287, 8805, 2144, 9986, 4422, 6456, 3165, 2306, 2496, 5513, 5704, 3585, 4140, 6845, 5516, 1192, 8590, 5299, 9658, 5204, 356, 4820, 6312, 360, 1196, 6994, 8659, 6512, 8296, 8041, 9822, 9085, 2176, 9924, 3744, 5293, 5534, 1298, 5446, 3339, 3840, 8365, 2872, 9399, 7355, 89, 3793, 9131, 9365, 2665, 1995, 4363, 838, 6583, 6372, 1897, 7838, 7759, 922, 6107, 2920, 16, 5741, 102, 1802, 7106, 3236, 9690, 307, 194, 7579, 8439, 6986, 2143, 2229, 6997, 3279, 1410, 1062, 6967, 3921, 3034, 5196, 5469, 6207, 9634, 4147, 9471, 6558, 1999, 6161, 9112, 3893, 6948, 3943, 604, 3285, 3054, 4258, 6388, 9910, 3247, 917, 5318, 3682, 7071, 1055, 8681, 9868, 7485, 5254, 2152, 9866, 120, 2925, 1601, 7314, 9557, 8711, 1437, 4214, 9305, 6616, 2166, 1670, 9439, 909, 1175, 5550, 3249, 2901, 345, 8757, 5211, 5388, 8155, 6243, 9438, 6064, 9973, 1561, 9533, 7142, 5171, 8351, 8126, 2187, 8650, 8628, 6883, 7928, 4570, 620, 8718, 7128, 4794, 3348, 9092, 6889, 143, 8723, 6712, 9007, 113, 7836, 38, 1682, 4476, 9396, 2676, 171, 1715, 7419, 9701, 1467, 6146, 3575, 129, 9523, 831, 6759, 2295, 6130, 6023, 5424, 9617, 3607, 9035, 3548, 827, 6302, 9879, 6220, 7352, 6153, 2288, 9278, 305, 1807, 7095, 9998, 7040, 4289, 7097, 3616, 8904, 2236, 3251, 8894, 4516, 405, 9930, 4632, 9992, 1941, 7061, 2882, 5929, 8565, 2068, 43, 3344, 8395, 6585, 4168, 8174, 4004, 2606, 231, 5298, 6930, 2052, 8562, 3197, 74, 1907, 4, 180, 684, 2618, 4103, 5342, 748, 5475, 932, 9874, 5296, 5507, 485, 4600, 1569, 3864, 7454, 8253, 4153, 4209, 8692, 6132, 3739, 6539, 1873, 9791, 3291, 5738, 944, 3813, 8686, 4267, 5056, 8133, 1964, 850, 4886, 3759, 9197, 7054, 9442, 2069, 8965, 8714, 698, 4910, 3005, 7715, 5218, 202, 6401, 4841, 6261, 9584, 4030, 9759, 8680, 7736, 1363, 7910, 4188, 7681, 6514, 9357, 5372, 8657, 8008, 1861, 6108, 8600, 2370, 1770, 8821, 9679, 7446, 5543, 7169, 2264, 3281, 1560, 8113, 912, 8208, 5664, 7551, 9767, 8959, 6228, 4766, 8924, 4881, 8968, 8656, 5623, 9, 5947, 617, 4765, 9081, 483, 5058, 9821, 2097, 9633, 2988, 9638, 6458, 3717, 3075, 7703, 7307, 7022, 663, 9846, 6248, 2282, 8710, 6609, 6135, 9687, 5582, 5247, 6941, 4070, 4076, 4118, 2174, 5304, 7091, 1145, 8301, 1893, 2070, 1076, 9395, 1046, 9147, 6398, 2234, 2080, 8889, 6606, 2658, 4395, 4681, 4921, 54, 4236, 4652, 6574, 1262, 1423, 3960, 3825, 7580, 4835, 8940, 1572, 7112, 6641, 720, 4127, 1030, 645, 9814, 4653, 5163, 8516, 3624, 5263, 7823, 3308, 6030, 579, 8339, 3077, 2420, 8999, 3807, 6968, 8341, 7609, 3256, 9504, 3189, 1749, 9256, 2780, 9169, 9262, 5525, 9692, 3458, 5605, 3290, 2391, 6807, 2465, 7560, 7713, 6763, 7272, 191, 5366, 376, 1521, 3653, 1253, 6719, 890, 2957, 7685, 7850, 3135, 2978, 678, 9850, 656, 9500, 780, 5879, 6682, 124, 3771, 8240, 1252, 5815, 2756, 9090, 7056, 5035, 3364, 5526, 8458, 6884, 5305, 8712, 6067, 644, 5335, 7397, 2106, 3557, 2190, 9651, 2895, 7241, 6799, 4598, 8579, 2180, 3429, 1498, 8836, 1104, 3725, 9774, 8258, 9723, 2285, 5881, 8324, 1380, 8411, 1661, 445, 8982, 6637, 8707, 3719, 8818, 3809, 690, 8575, 8170, 8029, 3101, 176, 9864, 7604, 3003, 3324, 1681, 5889, 8335, 4546, 8052, 2813, 9556, 387, 889, 5031};
int _RAZREDI[] = {0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
