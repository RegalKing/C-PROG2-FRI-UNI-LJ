#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {9637, 2487, 1588, 8722, 7322, 441, 2791, 3979, 9910, 2924, 8789, 6314, 3299, 9112, 4086, 9648, 4898, 3670, 3166, 2174, 971, 4010, 4734, 9269, 4161, 678, 6641, 3252, 761, 7290, 5826, 330, 2137, 8769, 8713, 4892, 1319, 5502, 1656, 8912, 6899, 9559, 1984, 8412, 6460, 737, 8070, 1972, 9645, 8499, 6816, 7588, 6008, 2413, 4641, 8214, 7926, 4234, 2534, 134, 9019, 3276, 2351, 1559, 9219, 5702, 9355, 9196, 5564, 944, 609, 8425, 354, 197, 9972, 9279, 7975, 870, 9396, 5902, 379, 3462, 5777, 8727, 836, 3306, 7583, 8353, 5512, 7311, 6919, 2276, 8097, 5193, 4227, 8662, 7863, 7379, 3944, 4, 590, 1102, 8931, 1092, 4077, 8594, 8760, 6701, 1336, 1335, 7846, 3597, 6875, 24, 3865, 9076, 6071, 7564, 4705, 6335, 1400, 2693, 7012, 6206, 4219, 6513, 9676, 8959, 1138, 6471, 8761, 3041, 273, 3221, 8135, 192, 4605, 1576, 9325, 6299, 5782, 7508, 753, 2672, 3536, 6797, 5652, 6748, 8787, 436, 577, 1792, 3709, 3055, 8549, 2151, 2835, 160, 7667, 5648, 8756, 6700, 3, 2890, 838, 7506, 171, 7158, 8134, 1484, 9815, 8276, 3393, 3209, 894, 3923, 7772, 4327, 7365, 1243, 7503, 497, 2208, 9668, 481, 1334, 414, 5707, 3463, 5991, 187, 1058, 1616, 4157, 1551, 9094, 8006, 1091, 6389, 6611, 2324, 5553, 1553, 8256, 9829, 2908, 3793, 2244, 9598, 932, 5669, 6, 1802, 4026, 4873, 8162, 3046, 7230, 4934, 9136, 4059, 1594, 3629, 2994, 1801, 2701, 9056, 935, 5167, 9108, 1754, 6014, 3593, 4503, 1855, 3341, 3406, 4723, 1260, 2992, 7111, 7596, 910, 5242, 3736, 5106, 412, 8678, 1856, 4159, 3430, 7910, 3039, 485, 4529, 8773, 980, 9454, 5381, 1141, 9956, 6427, 3106, 1006, 5964, 8897, 3562, 7958, 8191, 4363, 4530, 603, 6565, 4757, 1670, 1677, 1112, 2270, 697, 4413, 5419, 6196, 2181, 3335, 2817, 5999, 8674, 7305, 1019, 3416, 1600, 960, 3753, 8030, 6485, 2684, 3338, 2357, 3405, 216, 982, 1330, 820, 3678, 6320, 1740, 4432, 6228, 4139, 7982, 4661, 7137, 9807, 1730, 9331, 8472, 4154, 3945, 5737, 7173, 6735, 631, 3501, 4015, 9081, 2110, 5112, 728, 4167, 8326, 8059, 2157, 13, 4781, 4922, 6214, 7946, 5882, 3226, 8946, 4278, 5535, 1166, 2502, 1424, 8418, 2001, 1602, 8804, 9350, 8568, 397, 7783, 4109, 9636, 3850, 8886, 7277, 7695, 357, 6781, 5789, 86, 5412, 4877, 4238, 7207, 307, 6452, 2824, 1454, 1487, 6660, 8046, 6369, 6598, 6672, 4893, 9912, 9743, 6269, 7702, 723, 5196, 8553, 7263, 287, 6935, 4192, 9683, 3702, 4598, 8495, 8227, 1448, 5328, 4191, 9403, 1568, 1433, 3126, 3204, 4178, 7389, 424, 757, 7297, 8515, 5686, 5072, 7796, 2845, 5158, 5894, 6523, 6255, 6670, 3154, 3016, 6353, 3909, 7406, 4521, 5619, 5213, 9555, 8422, 1070, 9434, 9179, 5876, 3192, 2444, 2999, 7830, 1062, 8288, 2844, 3595, 3342, 4792, 9619, 7816, 4538, 7924, 1775, 6515, 9004, 4355, 8750, 4870, 3553, 9773, 4967, 7007, 561, 2786, 8357, 6204, 6518, 3482, 6668, 9412, 6242, 1987, 4956, 571, 3816, 5928, 2866, 4320, 3938, 349, 1738, 6197, 5596, 6483, 6507, 1245, 405, 2590, 492, 1811, 6764, 7631, 152, 9263, 1886, 2427, 3965, 6350, 8241, 2075, 7196, 4555, 8254, 4972, 6743, 2072, 6671, 5730, 5209, 7804, 4204, 5620, 9017, 947, 6095, 7166, 8706, 529, 7344, 5681, 9904, 5888, 5047, 908, 6590, 8039, 5378, 4543, 808, 7124, 9616, 1581, 7665, 1271, 1615, 6804, 8628, 685, 9631, 57, 9338, 3829, 35, 2257, 6125, 4634, 36, 3407, 9238, 8703, 2032, 4794, 5272, 8915, 4025, 9382, 8111, 6271, 1747, 7001, 1048, 4317, 9245, 9791, 6347, 1978, 5585, 1126, 7767, 1995, 9332, 7058, 4791, 9776, 8742, 5426, 3072, 7430, 5437, 8206, 4106, 2784, 5304, 9921, 4195, 3495, 1823, 6737, 3606, 5113, 4325, 1641, 533, 1213, 6988, 8775, 9494, 1275, 8392, 3805, 7258, 6344, 3892, 6550, 1907, 4642, 3616, 785, 9903, 9592, 9841, 4417, 6053, 4850, 8714, 1152, 5793, 5695, 7752, 2749, 3897, 5785, 1342, 4561, 11, 789, 5989, 7955, 6189, 6727, 8467, 4201, 876, 2153, 7457, 8498, 383, 5166, 5058, 2811, 8721, 9168, 7919, 9907, 9570, 7684, 986, 576, 434, 5015, 2930, 5538, 7706, 6663, 8361, 9990, 5172, 7044, 7084, 5948, 3439, 3838, 3751, 1619, 7803, 8542, 100, 1482, 8457, 2550, 284, 3921, 9456, 6465, 3864, 7146, 4305, 8679, 4053, 7981, 2803, 925, 366, 9718, 1936, 340, 9069, 9373, 9994, 4169, 919, 7205, 1558, 4065, 9362, 2746, 6688, 4084, 1943, 9257, 877, 7496, 7805, 381, 8856, 6396, 9530, 3757, 8321, 5004, 2250, 2016, 8120};
int _RAZREDI[] = {0, 1, 2, 3, 4, 5, 6, 2, 7, 8, 9, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18, 4, 19, 20, 21, 22, 23, 24, 25, 6, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 28, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 18, 55, 56, 57, 58, 59, 60, 5, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 26, 106, 107, 108, 109, 110, 111, 112, 113, 5, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 6, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 6, 160, 161, 162, 163, 164, 165, 166, 100, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 19, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 102, 214, 215, 216, 217, 218, 145, 219, 220, 221, 222, 223, 39, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 98, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 95, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 165, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 267, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 141, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 22, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 170, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 312, 397, 398, 399, 400, 401, 402, 403, 404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 371, 446, 145, 355, 447, 448, 449, 450, 451, 452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483, 484, 485, 486, 487, 488, 489, 362, 490, 491, 492, 493, 494, 495, 496, 497, 498, 499, 500, 501, 502, 503, 504, 505, 506, 507, 508, 509, 510, 511, 512, 513, 514, 515, 516, 517, 518, 519, 520, 521, 522, 523, 145, 524, 525, 526, 446, 22, 527, 528, 529, 530, 483, 531, 532, 533, 534, 535, 536, 537, 359, 538, 539, 540, 516, 541, 542, 543, 544, 545, 546, 547, 548, 549, 550, 57, 551, 552, 150, 359, 27, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568, 569, 570, 571, 572, 573, 574, 575, 576, 577, 578, 579, 580, 581, 582, 583, 584, 585, 586, 587, 588, 589, 325, 372, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600, 601, 602, 603, 604, 605, 606, 607, 608, 609, 610, 611, 612, 613, 614, 615, 616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627, 628, 629, 630, 631, 632, 633, 634, 635, 636, 637, 638, 535, 639, 640, 641, 642, 643, 644, 645, 646, 647, 51, 648, 649, 650, 651, 652, 653, 654, 655, 656, 657, 658, 659, 660, 661, 662, 663};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
