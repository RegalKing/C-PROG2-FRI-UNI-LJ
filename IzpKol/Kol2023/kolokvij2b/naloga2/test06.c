#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>

#include "naloga2.h"

#define _M 10001
int _P[] = {8572, 6765, 6257, 6631, 5498, 340, 5176, 3763, 6927, 297, 1204, 6387, 5541, 8663, 9474, 2523, 1552, 6321, 4298, 1905, 1605, 9649, 5142, 2677, 2847, 8101, 3409, 6184, 2135, 7041, 2498, 9313, 7719, 3523, 9464, 3445, 4482, 2976, 6000, 2467, 8102, 282, 2742, 6055, 4211, 2830, 8514, 7680, 5740, 6274, 9286, 239, 6783, 7686, 8629, 1572, 1456, 8905, 401, 3212, 7402, 8966, 3634, 9964, 9809, 3569, 7671, 964, 9254, 9349, 9470, 1292, 3990, 5574, 9531, 9148, 1119, 8837, 982, 8748, 2762, 9816, 4904, 5458, 9168, 8759, 8141, 42, 7304, 4722, 7932, 3966, 1222, 9749, 9894, 6681, 408, 5447, 2814, 5580, 9211, 1392, 2005, 4178, 3957, 9307, 1874, 9715, 8163, 9107, 6382, 425, 578, 407, 2285, 1293, 53, 416, 1886, 6454, 7584, 4450, 7879, 1280, 6159, 7700, 7400, 7549, 9413, 4762, 8211, 8626, 9683, 46, 3221, 3787, 8581, 1759, 3442, 8822, 6709, 4240, 2973, 3031, 7026, 9728, 3472, 4466, 1316, 1356, 8630, 7177, 2510, 7274, 4161, 9744, 8186, 5041, 4557, 8309, 9941, 3395, 5781, 7942, 7572, 2625, 995, 9567, 5443, 7979, 7814, 830, 9072, 6526, 1419, 8936, 5606, 488, 8096, 2226, 2388, 6429, 8761, 7200, 7665, 6875, 5708, 5397, 4316, 7847, 6965, 2629, 6361, 6519, 9992, 7841, 8218, 222, 3752, 5185, 1370, 1826, 8357, 9741, 41, 1278, 3345, 1359, 5538, 1080, 749, 2105, 3796, 7952, 2878, 4288, 4857, 1064, 1645, 4694, 931, 2418, 8445, 9232, 3380, 5838, 9270, 9253, 3265, 7779, 6629, 5695, 85, 2652, 4260, 906, 4814, 7344, 2376, 2895, 3094, 9361, 6282, 8118, 8908, 8854, 8530, 5733, 1639, 2111, 3389, 1932, 4805, 9174, 7998, 80, 6119, 493, 7713, 248, 3560, 1502, 7008, 8679, 8562, 2319, 4424, 1566, 3714, 4817, 4850, 8847, 5908, 9730, 3424, 2636, 2698, 5684, 5362, 3166, 1733, 9228, 4038, 7531, 4108, 8722, 317, 6958, 3535, 4778, 1801, 266, 8260, 3586, 51, 6171, 1190, 8344, 2765, 3798, 3025, 1418, 9729, 2108, 1712, 7466, 2324, 6600, 7220, 2703, 4160, 5002, 922, 2266, 8955, 3629, 1203, 7246, 2985, 8780, 4463, 1553, 2014, 883, 6132, 8844, 3519, 2260, 2300, 1287, 2879, 2678, 5907, 4142, 7725, 7836, 9136, 3439, 2354, 7745, 166, 6139, 5765, 5806, 562, 9998, 1229, 8429, 6078, 9088, 6164, 2600, 8471, 9647, 8564, 7746, 7927, 119, 511, 4715, 809, 6956, 569, 8778, 7622, 2680, 9735, 7057, 1365, 2829, 6138, 4521, 8665, 4522, 6636, 15, 6445, 6505, 7669, 7844, 368, 8050, 8407, 7169, 4359, 9429, 8360, 455, 3579, 703, 2702, 9846, 3256, 5553, 9014, 506, 2042, 5211, 2590, 3320, 8708, 8799, 6794, 8779, 4459, 3692, 7946, 278, 5644, 5579, 8529, 6517, 4533, 6837, 8862, 3522, 8858, 7017, 1653, 8563, 240, 7456, 7337, 9267, 6886, 6917, 5042, 3765, 8523, 2696, 1383, 4984, 4343, 2133, 1840, 4846, 3014, 6075, 9672, 9891, 5776, 1737, 7179, 1310, 7539, 9935, 9844, 6191, 3422, 1701, 3378, 9301, 7215, 8720, 5235, 4848, 7657, 2442, 6071, 657, 794, 1970, 6096, 9514, 9235, 3072, 8533, 616, 1512, 9292, 3573, 1454, 5892, 7857, 5434, 8974, 2491, 1924, 4675, 6976, 6811, 112, 6194, 7014, 7545, 6759, 5431, 7923, 877, 3208, 3504, 2293, 8789, 4265, 8261, 4084, 5614, 7152, 7659, 3771, 7982, 3512, 6053, 7107, 7117, 3950, 2406, 6174, 7174, 1288, 4168, 9139, 7919, 1772, 7410, 4302, 9667, 3304, 1786, 9831, 2211, 1221, 2470, 9191, 1220, 4055, 5234, 686, 2121, 1542, 5128, 1583, 665, 5726, 5037, 7726, 5095, 5416, 9989, 1145, 8874, 6421, 7679, 5823, 3495, 889, 8592, 3620, 2389, 8996, 1245, 3175, 1612, 2236, 3924, 1752, 7436, 3270, 1573, 1844, 6887, 5900, 1251, 9119, 7882, 9693, 2744, 2596, 1756, 3716, 409, 6353, 5942, 2093, 5370, 9418, 1113, 6786, 7821, 6970, 3836, 967, 1980, 3630, 5040, 4145, 5677, 9265, 3258, 1362, 2795, 260, 7286, 8555, 6009, 7752, 7052, 4104, 3970, 1034, 911, 5240, 6693, 6908, 4073, 9099, 1014, 5618, 7028, 7696, 9688, 2805, 2673, 581, 5516, 4324, 421, 1494, 4253, 9210, 4632, 7051, 772, 2258, 5483, 9876, 9638, 9882, 9612, 6984, 9145, 3555, 558, 1076, 4992, 6611, 6148, 1286, 4082, 6464, 8078, 1290, 4516, 9172, 935, 4970, 8424, 6902, 5062, 3995, 5331, 279, 2536, 9704, 6435, 8384, 9054, 7962, 5011, 6939, 8704, 5108, 4506, 4699, 2585, 2220, 2758, 9347, 8980, 4813, 4671, 7074, 2890, 8984, 275, 9164, 9506, 7216, 1669, 8294, 4235, 3840, 3650, 5771, 3283, 4841, 6161, 5178, 3705, 1908, 2679, 2207, 5489, 6428, 9480, 7744, 4133, 6934, 3593, 3711, 5251, 4998, 5499, 2574, 3015, 3724, 7977, 7974, 3162, 9220, 4010, 9569, 2454, 6922, 8370, 2306, 1557, 7553, 8597, 2217, 6874, 512, 1734, 9696, 4725, 1298, 5302, 5667, 944, 5719, 3232, 6834, 2933, 3475, 5707, 5537, 6553, 7613, 937, 5595, 3554, 7232, 6098, 9598, 4110, 9837, 5157, 8415, 6858, 2889, 3479, 9742, 1346, 5750, 4035, 1930, 3077, 9358, 5526, 2722, 9001, 7061, 8317, 9977, 5298, 1450, 4856, 410, 8841, 2648, 6949, 9060, 253, 7543, 2039, 7747, 6128, 316, 1706, 2796, 1, 910, 7578, 4902, 2297, 7376, 325, 7005, 7247, 3942, 2311, 5435, 2365, 1132, 8143, 9494, 6838, 1814, 9296, 1358, 185, 8903, 9151, 4014, 4782, 1707, 2036, 4331, 7861, 5742, 2768, 3614, 1894, 7312, 9835, 5513, 8674, 2264, 3238, 7918, 853, 1971, 9610, 2316, 215, 9096, 4753, 4000, 4917, 3513, 9071, 7300, 586, 5820, 8105, 2655, 5429, 8997, 8492, 2767, 5631, 7294, 6617, 620, 6541, 129, 8804, 6712, 1689, 9808, 6513, 4092, 6969, 9929, 8279, 2141, 2223, 2872, 6243, 2127, 1375, 1916, 2061, 2632, 7097, 7184, 9539, 4011, 2915, 738, 1333, 5992, 8103, 698, 524, 440, 2504, 9996, 1326, 4819, 9751, 3901, 7825, 7242};
int _RAZREDI[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 5, 0, 0, 0, 0, 0, 2, 0, 5, 0, 0, 0, 7, 0, 8, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 9, 0, 10, 0, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 6, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 0, 0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 1, 0, 0, 12, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 11, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12, 6, 0, 0, 0, 0, 8, 0, 0, 0, 0, 11, 0, 0, 0, 8, 0, 8, 0, 16, 6, 0, 0, 17, 8, 0, 0, 18, 0, 0, 0, 12, 9, 0, 0, 0, 0, 0, 0, 8, 5, 13, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14, 0, 2, 20, 0, 21, 0, 0, 0, 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 22, 11, 23, 15, 0, 0, 0, 0, 0, 8, 2, 0, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 12, 17, 12, 24, 14, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 25, 26, 0, 0, 0, 0, 11, 0, 0, 9, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0, 0, 0, 0, 0, 6, 0, 27, 0, 28, 0, 0, 0, 0, 18, 0, 0, 0, 0, 29, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 30, 0, 0, 0, 0, 31, 12, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 28, 0, 2, 0, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 33, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 34, 35, 0, 0, 0, 10, 0, 0, 0, 8, 0, 0, 1, 21, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 36, 0, 6, 23, 0, 6, 0, 0, 0, 22, 0, 0, 0, 0, 0, 37, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 38, 0, 0, 0, 39, 0, 0, 0, 0, 0, 8, 23, 0, 0, 0, 0, 0, 0, 0, 0, 35, 0, 12, 0, 0, 0, 5, 40, 41, 8, 0, 0, 0, 0, 1, 42, 0, 0, 4, 0, 0, 0, 0, 0, 0, 5, 22, 0, 0, 0, 43, 0, 0, 0, 17, 0, 9, 2, 0, 0, 0, 0, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12, 5, 0, 44, 0, 0, 0, 0, 35, 6, 5, 0, 0, 0, 0, 0, 18, 0, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0, 0, 45, 33, 0, 0, 0, 0, 1, 0, 0, 46, 0, 0, 47, 0, 0, 0, 48, 0, 0, 0, 0, 0, 0, 0, 0, 12, 12, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0};
int _ST_VOZLISC = sizeof(_RAZREDI) / sizeof(_RAZREDI[0]);
#define  _ST_RAZREDOV (sizeof(_P) / sizeof(_P[0]))
Vozlisce* _I2V[_ST_RAZREDOV];
bool _POBRISAN[_M];

Vozlisce* _ustvari() {
    Vozlisce* zacetek = NULL;
    Vozlisce* prej = NULL;
    int zadnjiRazred = -1;

    for (int i = 0; i < _ST_VOZLISC; i++) {
        Vozlisce* v = calloc(1, sizeof(Vozlisce));
        int r = _RAZREDI[i];
        if (r > zadnjiRazred) {
            zadnjiRazred = r;
            v->p = malloc(sizeof(int));
            *v->p = _P[r];
            _I2V[r] = v;
        } else {
            v->p = _I2V[r]->p;
        }
        if (i == 0) {
            zacetek = v;
        } else {
            prej->naslednje = v;
        }
        prej = v;
    }
    return zacetek;
}

void _izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* w = v;
    while (w != NULL) {
        printf("%s%d", (w == v ? "" : ", "), *w->p);
        w = w->naslednje;
    }
    printf("]\n");
}

void _preveriIstovetnost(Vozlisce* v) {
    int i = 0;
    for (Vozlisce* w = v; w != NULL; w = w->naslednje) {
        printf("%d", w == _I2V[i]);
        i++;
    }
    printf("\n");
}

void _pocisti(Vozlisce* v) {
    if (v != NULL) {
        _pocisti(v->naslednje);
        int pp = *v->p;
        if (!_POBRISAN[pp]) {
            free(v->p);
            v->p = NULL;
            _POBRISAN[pp] = true;
        }
        free(v);
    }
}

int main() {
    Vozlisce* v = _ustvari();

    printf("Prej:\n");
    _izpisi(v);
    printf("\n");

    izlociDuplikate(v);

    printf("Potem:\n");
    _izpisi(v);
    printf("\n");

    printf("Istovetnost ohranjenih vozlisc:\n");
    _preveriIstovetnost(v);

    _pocisti(v);

    return 0;
}
